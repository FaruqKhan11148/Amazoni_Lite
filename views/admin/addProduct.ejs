<h2>Add Product</h2>

<form action="/api/products" method="POST" enctype="multipart/form-data">

  <!-- PRODUCT NAME -->
  <input
    type="text"
    name="name"
    placeholder="Product name"
    required
  />

  <!-- DESCRIPTION -->
  <textarea
    name="description"
    placeholder="Product description"
  ></textarea>

  <!-- PRICE -->
  <input
    type="number"
    name="price"
    placeholder="Price"
    required
  />

  <!-- STOCK -->
  <input
    type="number"
    name="stock"
    placeholder="Stock"
    required
  />

  <!-- CATEGORY -->
  <select id="category" name="category_id" required>
    <option value="">Select Category</option>

    <% categories.forEach(cat => { %>
      <option value="<%= cat.id %>">
        <%= cat.name %>
      </option>
    <% }) %>
  </select>

  <!-- SUBCATEGORY -->
  <select id="subcategory" name="subcategory_id" required>
    <option value="">Select Subcategory</option>
  </select>

  <!-- IMAGE UPLOAD -->
  <input
    type="file"
    name="image"
    accept="image/*"
    required
  />

  <button type="submit">Add Product</button>
</form>

<script>
  const category = document.getElementById("category");
  const subcategory = document.getElementById("subcategory");

  category.addEventListener("change", async () => {
    const categoryId = category.value;

    if (!categoryId) {
      subcategory.innerHTML = `<option value="">Select Subcategory</option>`;
      return;
    }

    try {
      const res = await fetch(`/api/admin/subcategories/${categoryId}`);
      if (!res.ok) throw new Error('Failed to fetch subcategories');

      const data = await res.json();

      subcategory.innerHTML = `<option value="">Select Subcategory</option>`;
      data.forEach(sub => {
        subcategory.innerHTML += `<option value="${sub.id}">${sub.name}</option>`;
      });
    } catch (err) {
      console.error(err);
      subcategory.innerHTML = `<option value="">Error loading subcategories</option>`;
    }
  });
</script>
